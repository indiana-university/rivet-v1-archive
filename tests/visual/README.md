# Automated visual difference testing

Visual difference testing is accomplished by running a headless browser pointed at each component page, taking a screen shot, and then comparing that screenshot to one of a "golden" screenshot that is a visually correct representation of the component.

## Running the tests

```
npm run visual-test
```

This will rebuild the site, and then step through each component, comparing its current visual representation with the golden screenshot for that component. If the screenshots are different, the test will fail with the number of pixels that differed.

## Updating the golden screenshots

Golden screenshots are checked in to source control, and should always reflect the current intended visual styles. When visual updates are made to Rivet, the screenshots can be regenerated:

```
npm run testing-screenshots
```

## Adding components to the test

The components tested are defined in [utils.js](./utils.js) as `const componentNames`. For each name, the browser visits `http://localhost:3000/components/preview/{componentName}.html`, which is the preview page generated by Fractal for each component. 

For components with multiple variations, `{componentName}--default` refers to the base component. `{componentName}--{variationName}` can be used to reference other variations of a component and test them as well.

After adding a new component, be sure to update the golden screenshots as described above.